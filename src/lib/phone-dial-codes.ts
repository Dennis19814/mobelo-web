/**
 * Dial code (digits only, longest first) -> country name.
 * Used to parse full phone (e.g. "+93011111111") and show country code + name.
 */
const DIAL_PREFIX_TO_NAME: [string, string][] = [
  // 4-digit (try before 1-digit)
  ['1684', 'American Samoa'],
  ['1264', 'Anguilla'],
  ['1758', 'Saint Lucia'],
  ['1345', 'Cayman Islands'],
  ['1284', 'British Virgin Islands'],
  ['1246', 'Barbados'],
  ['1441', 'Bermuda'],
  ['1268', 'Antigua and Barbuda'],
  ['1340', 'U.S. Virgin Islands'],
  ['1671', 'Guam'],
  ['1767', 'Dominica'],
  ['1809', 'Dominican Republic'],
  ['1829', 'Dominican Republic'],
  ['1868', 'Trinidad and Tobago'],
  ['1869', 'Saint Kitts and Nevis'],
  ['1876', 'Jamaica'],
  ['1649', 'Turks and Caicos Islands'],
  ['1664', 'Montserrat'],
  ['1784', 'Saint Vincent and the Grenadines'],
  ['1787', 'Puerto Rico'],
  ['1939', 'Puerto Rico'],
  ['1670', 'Northern Mariana Islands'],
  ['1473', 'Grenada'],
  // 3-digit
  ['998', 'Uzbekistan'],
  ['996', 'Kyrgyzstan'],
  ['995', 'Georgia'],
  ['994', 'Azerbaijan'],
  ['993', 'Turkmenistan'],
  ['992', 'Tajikistan'],
  ['971', 'United Arab Emirates'],
  ['970', 'Palestine'],
  ['968', 'Oman'],
  ['967', 'Yemen'],
  ['966', 'Saudi Arabia'],
  ['965', 'Kuwait'],
  ['964', 'Iraq'],
  ['963', 'Syria'],
  ['962', 'Jordan'],
  ['961', 'Lebanon'],
  ['960', 'Maldives'],
  ['886', 'Taiwan'],
  ['880', 'Bangladesh'],
  ['856', 'Laos'],
  ['855', 'Cambodia'],
  ['853', 'Macao'],
  ['852', 'Hong Kong'],
  ['850', 'North Korea'],
  ['692', 'Marshall Islands'],
  ['691', 'Micronesia'],
  ['690', 'Tokelau'],
  ['689', 'French Polynesia'],
  ['688', 'Tuvalu'],
  ['687', 'New Caledonia'],
  ['686', 'Kiribati'],
  ['685', 'Samoa'],
  ['683', 'Niue'],
  ['682', 'Cook Islands'],
  ['681', 'Wallis and Futuna'],
  ['680', 'Palau'],
  ['679', 'Fiji'],
  ['678', 'Vanuatu'],
  ['677', 'Solomon Islands'],
  ['676', 'Tonga'],
  ['675', 'Papua New Guinea'],
  ['674', 'Nauru'],
  ['673', 'Brunei'],
  ['672', 'Antarctica'],
  ['670', 'Timor-Leste'],
  ['599', 'Curaçao'],
  ['598', 'Uruguay'],
  ['597', 'Suriname'],
  ['596', 'Martinique'],
  ['595', 'Paraguay'],
  ['594', 'French Guiana'],
  ['593', 'Ecuador'],
  ['592', 'Guyana'],
  ['591', 'Bolivia'],
  ['590', 'Guadeloupe'],
  ['509', 'Haiti'],
  ['508', 'Saint Pierre and Miquelon'],
  ['507', 'Panama'],
  ['506', 'Costa Rica'],
  ['505', 'Nicaragua'],
  ['504', 'Honduras'],
  ['503', 'El Salvador'],
  ['502', 'Guatemala'],
  ['501', 'Belize'],
  ['500', 'Falkland Islands'],
  ['423', 'Liechtenstein'],
  ['421', 'Slovakia'],
  ['420', 'Czech Republic'],
  ['389', 'North Macedonia'],
  ['383', 'Kosovo'],
  ['382', 'Montenegro'],
  ['381', 'Serbia'],
  ['380', 'Ukraine'],
  ['379', 'Vatican City'],
  ['378', 'San Marino'],
  ['377', 'Monaco'],
  ['376', 'Andorra'],
  ['375', 'Belarus'],
  ['374', 'Armenia'],
  ['373', 'Moldova'],
  ['372', 'Estonia'],
  ['371', 'Latvia'],
  ['370', 'Lithuania'],
  ['359', 'Bulgaria'],
  ['358', 'Finland'],
  ['357', 'Cyprus'],
  ['356', 'Malta'],
  ['355', 'Albania'],
  ['354', 'Iceland'],
  ['353', 'Ireland'],
  ['352', 'Luxembourg'],
  ['351', 'Portugal'],
  ['350', 'Gibraltar'],
  ['299', 'Greenland'],
  ['298', 'Faroe Islands'],
  ['297', 'Aruba'],
  ['291', 'Eritrea'],
  ['290', 'Saint Helena'],
  ['269', 'Comoros'],
  ['268', 'Eswatini'],
  ['267', 'Botswana'],
  ['266', 'Lesotho'],
  ['265', 'Malawi'],
  ['264', 'Namibia'],
  ['263', 'Zimbabwe'],
  ['262', 'Réunion'],
  ['261', 'Madagascar'],
  ['260', 'Zambia'],
  ['258', 'Mozambique'],
  ['257', 'Burundi'],
  ['256', 'Uganda'],
  ['255', 'Tanzania'],
  ['254', 'Kenya'],
  ['253', 'Djibouti'],
  ['252', 'Somalia'],
  ['251', 'Ethiopia'],
  ['250', 'Rwanda'],
  ['249', 'Sudan'],
  ['248', 'Seychelles'],
  ['246', 'British Indian Ocean Territory'],
  ['245', 'Guinea-Bissau'],
  ['244', 'Angola'],
  ['243', 'DR Congo'],
  ['242', 'Republic of the Congo'],
  ['241', 'Gabon'],
  ['240', 'Equatorial Guinea'],
  ['239', 'São Tomé and Príncipe'],
  ['238', 'Cape Verde'],
  ['237', 'Cameroon'],
  ['236', 'Central African Republic'],
  ['235', 'Chad'],
  ['234', 'Nigeria'],
  ['233', 'Ghana'],
  ['232', 'Sierra Leone'],
  ['231', 'Liberia'],
  ['230', 'Mauritius'],
  ['229', 'Benin'],
  ['228', 'Togo'],
  ['227', 'Niger'],
  ['226', 'Burkina Faso'],
  ['225', 'Ivory Coast'],
  ['224', 'Guinea'],
  ['223', 'Mali'],
  ['222', 'Mauritania'],
  ['221', 'Senegal'],
  ['220', 'Gambia'],
  ['218', 'Libya'],
  ['216', 'Tunisia'],
  ['213', 'Algeria'],
  ['212', 'Morocco'],
  ['211', 'South Sudan'],
  // 2-digit
  ['98', 'Iran'],
  ['95', 'Myanmar'],
  ['94', 'Sri Lanka'],
  ['93', 'Afghanistan'],
  ['92', 'Pakistan'],
  ['91', 'India'],
  ['90', 'Turkey'],
  ['86', 'China'],
  ['84', 'Vietnam'],
  ['82', 'South Korea'],
  ['81', 'Japan'],
  ['66', 'Thailand'],
  ['65', 'Singapore'],
  ['64', 'New Zealand'],
  ['63', 'Philippines'],
  ['62', 'Indonesia'],
  ['61', 'Australia'],
  ['60', 'Malaysia'],
  ['58', 'Venezuela'],
  ['57', 'Colombia'],
  ['56', 'Chile'],
  ['55', 'Brazil'],
  ['54', 'Argentina'],
  ['53', 'Cuba'],
  ['52', 'Mexico'],
  ['51', 'Peru'],
  ['49', 'Germany'],
  ['48', 'Poland'],
  ['47', 'Norway'],
  ['46', 'Sweden'],
  ['45', 'Denmark'],
  ['44', 'United Kingdom'],
  ['43', 'Austria'],
  ['41', 'Switzerland'],
  ['40', 'Romania'],
  ['39', 'Italy'],
  ['36', 'Hungary'],
  ['34', 'Spain'],
  ['33', 'France'],
  ['32', 'Belgium'],
  ['31', 'Netherlands'],
  ['30', 'Greece'],
  ['27', 'South Africa'],
  ['20', 'Egypt'],
  // 1-digit
  ['7', 'Russia'],
  ['1', 'United States'],
];

export interface ParsedCountryFromPhone {
  dialCode: string;
  countryName: string;
}

/**
 * Extract country dial code and name from a full phone number (e.g. "+93011111111").
 * Tries longest matching prefix first. Returns null if phone is empty or no match.
 */
export function getCountryFromPhone(phone: string | null | undefined): ParsedCountryFromPhone | null {
  if (!phone || typeof phone !== 'string') return null;
  const digits = phone.replace(/\D/g, '');
  if (!digits.length) return null;
  for (const [prefix, countryName] of DIAL_PREFIX_TO_NAME) {
    if (prefix && digits.startsWith(prefix)) {
      return {
        dialCode: `+${prefix}`,
        countryName,
      };
    }
  }
  return null;
}
